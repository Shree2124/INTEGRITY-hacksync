{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/HAcksync%20v2/src/app/%28site%29/alertview/page.tsx"],"sourcesContent":["'use client';\r\nimport React, { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport {\r\n  ArrowLeft,\r\n  AlertTriangle,\r\n  ArrowRight,\r\n  ShieldAlert,\r\n  CheckCircle2,\r\n  Clock\r\n} from 'lucide-react';\r\nimport { motion } from 'framer-motion';\r\nimport { supabase } from '@/lib/dbConnect';\r\n\r\nexport default function AlertsPage() {\r\n  const [reports, setReports] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    async function loadAlerts() {\r\n      try {\r\n        const response = await fetch('/api/map');\r\n        const data = await response.json();\r\n        const highRisk = data.filter((r: any) => r.audit_results?.[0]?.risk_level === 'High');\r\n        setReports(highRisk);\r\n      } catch (error) {\r\n        console.error(\"Failed to load alerts:\", error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n    loadAlerts();\r\n\r\n    const channel = supabase\r\n      .channel('realtime-alerts')\r\n      .on(\r\n        'postgres_changes',\r\n        { event: 'INSERT', schema: 'public', table: 'audit_results' },\r\n        () => loadAlerts()\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, []);\r\n\r\n  const highRiskReports = reports;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-slate-50 font-sans text-slate-900\">\r\n      <div className=\"container mx-auto max-w-3xl pt-8 px-4 pb-24\">\r\n\r\n        <div className=\"flex items-center gap-2 mb-8\">\r\n          <Link\r\n            href=\"/dashboard\"\r\n            className=\"text-sm text-blue-600 font-medium flex items-center gap-1 hover:underline transition-all\"\r\n          >\r\n            <ArrowLeft size={16} /> Back to Homepage\r\n          </Link>\r\n        </div>\r\n\r\n        <div className=\"flex justify-between items-end mb-8\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-slate-900 font-serif flex items-center gap-2\">\r\n              Actionable Alerts\r\n              <span className=\"flex h-3 w-3 relative\">\r\n                <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75\"></span>\r\n                <span className=\"relative inline-flex rounded-full h-3 w-3 bg-red-500\"></span>\r\n              </span>\r\n            </h1>\r\n            <p className=\"text-slate-500 mt-2\">High-risk discrepancies requiring immediate attention.</p>\r\n          </div>\r\n          <div className=\"hidden sm:block text-right\">\r\n            <div className=\"text-2xl font-bold text-red-600\">{highRiskReports.length}</div>\r\n            <div className=\"text-xs text-slate-400 font-bold uppercase tracking-wider\">Active Critical Issues</div>\r\n          </div>\r\n        </div>\r\n\r\n        {loading ? (\r\n          <div className=\"text-center py-16\">\r\n            <Clock className=\"animate-spin w-8 h-8 mx-auto text-slate-300 mb-2\" />\r\n            <p className=\"text-slate-400\">Loading alerts...</p>\r\n          </div>\r\n        ) : highRiskReports.length === 0 ? (\r\n          <div className=\"text-center py-16 bg-white rounded-2xl border border-slate-200 shadow-sm\">\r\n            <div className=\"w-16 h-16 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n              <CheckCircle2 size={32} className=\"text-green-500\" />\r\n            </div>\r\n            <h3 className=\"text-lg font-bold text-slate-800\">All Clear!</h3>\r\n            <p className=\"text-slate-500\">No active high-risk alerts at the moment.</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-6\">\r\n            {highRiskReports.map((report, index) => {\r\n              const audit = report.audit_results?.[0];\r\n              const project = audit?.government_projects;\r\n              if (!project) return null;\r\n\r\n              return (\r\n                <motion.div\r\n                  key={report.id}\r\n                  initial={{ opacity: 0, y: 20 }}\r\n                  animate={{ opacity: 1, y: 0 }}\r\n                  transition={{ delay: index * 0.1 }}\r\n                  className=\"bg-white rounded-xl border border-slate-200 shadow-sm hover:shadow-lg transition-all overflow-hidden group\"\r\n                >\r\n                  <div className=\"bg-red-50 border-b border-red-100 px-6 py-3 flex justify-between items-center\">\r\n                    <div className=\"flex items-center gap-2 text-red-700 font-bold text-sm\">\r\n                      <ShieldAlert size={16} />\r\n                      CRITICAL RISK DETECTED\r\n                    </div>\r\n                    <div className={`text-[10px] font-bold uppercase px-2 py-1 rounded border ${report.status === 'Verified' ? 'bg-white text-green-700 border-green-200' :\r\n                      report.status === 'Audited' ? 'bg-white text-blue-700 border-blue-200' :\r\n                        'bg-white text-slate-600 border-slate-200'\r\n                      }`}>\r\n                      {report.status}\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div className=\"p-6\">\r\n                    {/* Project Info */}\r\n                    <div className=\"mb-4\">\r\n                      <div className=\"flex justify-between items-start\">\r\n                        <div>\r\n                          <h3 className=\"font-bold text-xl text-slate-900 mb-1 group-hover:text-blue-700 transition-colors\">\r\n                            {project.project_name}\r\n                          </h3>\r\n                          <p className=\"text-xs font-mono text-slate-400\">ID: {project.id.slice(0, 8)}</p>\r\n                        </div>\r\n                        <div className=\"text-right\">\r\n                          <span className=\"text-xs text-slate-400 block mb-1\">Contractor</span>\r\n                          <span className=\"text-xs font-semibold text-slate-600 bg-slate-100 px-2 py-1 rounded\">\r\n                            {project.contractor}\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-slate-50 p-4 rounded-lg border border-slate-100 mb-6 relative\">\r\n                      <div className=\"absolute top-4 left-4 text-slate-300\">\r\n                        <AlertTriangle size={20} />\r\n                      </div>\r\n                      <p className=\"text-sm text-slate-700 italic pl-8 leading-relaxed\">\r\n                        \"{audit.ai_verdict}\"\r\n                      </p>\r\n                      <div className=\"flex gap-2 mt-3 pl-8\">\r\n                        {audit.discrepancies?.map((d: string, i: number) => (\r\n                          <span key={i} className=\"text-[10px] font-bold text-red-600 bg-red-100 px-2 py-1 rounded border border-red-200\">\r\n                            {d}\r\n                          </span>\r\n                        ))}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <Link href={`/auditview`} className=\"w-full\">\r\n                      <button\r\n                        className=\"w-full py-3 bg-white border border-slate-200 text-slate-700 font-bold text-sm rounded-lg hover:bg-slate-900 hover:text-white hover:border-slate-900 transition-all flex items-center justify-center gap-2 group-hover:shadow-md\"\r\n                      >\r\n                        View Full Audit Report <ArrowRight size={16} />\r\n                      </button>\r\n                    </Link>\r\n                  </div>\r\n                </motion.div>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}